<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Business Dashboard â€“ Add Queue</title>
  <link rel="stylesheet" href="mstyle.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>

<body>

  <div class="page-wrapper">

    <h1 class="app-title">Business Dashboard</h1><br>

    <div class="topnav">

      <div class="nav-left">
        <a href="businessoverview.html">Overview</a>
        <a href="businessQueue.html">Queues</a>
        <a href="businessManage.html">Manage Queues</a>
        <a href="businessReports.html">View Reports / Analytics</a>
      </div>

      <div class="nav-right">
        <div class="account-dropdown">
          <div class="account-icon">ðŸ‘¤</div>
          <div class="account-menu">
            <a href="mainlogin.html">Logout</a>
          </div>
        </div>
      </div>
    </div>

    <div class="dashboard-container">

      <div class="add-form-card">

        <form class="add-queue-form" id="addQueueForm">

          <label>Queue Name</label>
          <input id="queueName" type="text" placeholder="Name of the queue" required>

          <label>Type</label>
          <input id="queueType" type="text" placeholder="Office, clinic, retail, etc.">

          <label>Date</label>
          <input id="queueDate" type="date">

          <label>Location</label>
          <input id="queueLocation" type="text" placeholder="Address or description" required>

          <label>Access</label>
          <input id="queueAccess" type="text" placeholder="Public, restricted, etc.">

          <label>Capacity</label>
          <input id="queueCapacity" type="number" placeholder="Max people allowed">

          <button type="submit" class="queue-btn add-btn big-submit-btn">Add</button>

        </form>

      </div>

    </div>

  </div>

  <script>
    const form = document.getElementById("addQueueForm");

    form.addEventListener("submit", async (e) => {
      e.preventDefault();

      const name = document.getElementById("queueName").value.trim();
      const category = document.getElementById("queueType").value.trim();
      const location = document.getElementById("queueLocation").value.trim();
      const working_days = document.getElementById("queueDate").value;

      const access = document.getElementById("queueAccess").value.trim();
      const capacity = document.getElementById("queueCapacity").value;

      const descriptionParts = [];
      if (access) descriptionParts.push(`Access: ${access}`);
      if (capacity) descriptionParts.push(`Capacity: ${capacity}`);
      const description = descriptionParts.join(" | ");

      if (!name || !location || !category) {
        alert("Please fill in name, location, and type.");
        return;
      }

      const payload = {
        name,
        location,
        working_days,
        waiting_time: 0,
        queue_length: 0,
        category,
        description
      };

      try {
        const res = await fetch("http://localhost:3000/businesses", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload)
        });

        const data = await res.json();

        if (!data.success) {
          alert(data.message || "Could not add queue");
          return;
        }

        alert("Queue added successfully");
        form.reset();
        window.location.href = "businessQueue.html";
      } catch (err) {
        console.error(err);
        alert("Error adding queue");
      }
    });
  </script>

</body>
</html>
